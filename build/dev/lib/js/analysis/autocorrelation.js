"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,r,a){return{createCube:function(e,a){var o=a.layout,s=r.validateDimension(o.props.dimensions[0]),i=[{qNullSuppression:!0,qDef:{qFieldDefs:[s],qSortCriterias:[{qSortByNumeric:1}]}}],p=r.validateMeasure(o.props.measures[0]),t=null;t=1===o.props.differencing?"R.ScriptEval('diff(na.omit(q$Measure),  "+o.props.seasonalDifferences+")', "+p+" as Measure)":2===o.props.differencing?"R.ScriptEval('diff(diff(na.omit(q$Measure), "+o.props.seasonalDifferences+"), "+o.props.firstDifferences+")', "+p+" as Measure)":p;var n="";o.props.lagMax===!1&&(n=", lag.max="+o.props.lagMaxValue+" ");var l=["acf","pacf"],c=[];$.each(l,function(e,r){1===o.props.differencing?c[r]=r+"(diff(na.omit(q$Measure), "+o.props.seasonalDifferences+"),plot=FALSE "+n+")$acf":2===o.props.differencing?c[r]=r+"(diff(diff(na.omit(q$Measure), "+o.props.seasonalDifferences+"), "+o.props.firstDifferences+"),plot=FALSE "+n+")$acf":c[r]=r+"(na.omit(q$Measure),plot=FALSE "+n+")$acf"}),r.displayDebugModeMessage(o.props.debugMode);var f=r.getDebugSaveDatasetScript(o.props.debugMode,"debug_autocorrelation.rda"),u="R.ScriptEval('"+f+" "+c.acf+"', "+p+" as Measure)",d="R.ScriptEval('"+c.pacf+"', "+p+" as Measure)",q="R.ScriptEval('high<-qnorm((1 + 0.95)/2)/sqrt(length(q$Measure));low<-qnorm((1 - 0.95)/2)/sqrt(length(q$Measure));c(high, low)', "+p+" as Measure)";r.displayRScriptsToConsole(o.props.debugMode,[u,d,q]);var g=[{qDef:{qDef:t}},{qDef:{qDef:u}},{qDef:{qDef:d}},{qDef:{qDef:q}},{qDef:{qLabel:"-",qDef:""}}];return a.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(i)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(g)}],!1),a.patchApplied=!0,null},drawChart:function(o,s){var i=a.defer(),p=o.layout,t=(r.validateDimension(p.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}]);return o.backendApi.getData(t).then(function(a){var t=o.layout.qHyperCube.qMeasureInfo;return isNaN(t[0].qMin)&&isNaN(t[0].qMax)&&isNaN(t[1].qMin)&&isNaN(t[1].qMax)&&isNaN(t[2].qMin)&&isNaN(t[2].qMax)&&isNaN(t[3].qMin)&&isNaN(t[3].qMax)?r.displayConnectionError(o.extId):!function(){r.displayReturnedDatasetToConsole(p.props.debugMode,a[0]);var i=r.getDefaultPaletteColor(),t=a[0].qMatrix[0][4].qNum,n=a[0].qMatrix[1][4].qNum,l=[],c=[],f=[];if($.each(a[0].qMatrix,function(e,r){l.push(r[0].qElemNumber),c.push(r[0].qText),f.push(r[1].qNum)}),1===p.props.differencing||2===p.props.differencing)for(var u=0;u<p.props.seasonalDifferences;u++)c.shift();if(2===p.props.differencing)for(var d=0;d<p.props.firstDifferences;d++)c.shift();var q=[{x:c,y:f,elemNum:l,name:"Observed",mode:"lines+markers",fill:p.props.line,fillcolor:p.props.colors?"rgba("+i[3]+",0.3)":"rgba("+r.getConversionRgba(p.props.colorForMain.color,1)+")",marker:{color:p.props.colors?"rgba("+i[3]+",1)":"rgba("+r.getConversionRgba(p.props.colorForMain.color,1)+")",size:p.props.datapoints?p.props.pointRadius:1},line:{width:p.props.borderWidth},xaxis:"x",yaxis:"y"}],g=void 0,x=void 0,h=void 0,y=void 0,m=void 0,v=[];v[2]=2,v[3]=4;for(var M=function(e){g=[],x=[],h=[],y=[],m={};var o=e-2;$.each(a[0].qMatrix,function(r,a){return"-"!==a[e].qText&&(g.push(o),x.push(a[e].qNum),h.push(t),y.push(n),void o++)}),q.push({x:g,y:x,name:2===e?"Autocorrelation":"Partial Autocorrelation",marker:{color:p.props.colors?"rgba("+i[3]+", 1)":"rgba("+r.getConversionRgba(p.props.colorForMain.color,1)+")"},type:"bar",width:.3,xaxis:"x"+e,yaxis:"y"+e}),q.push({x:g,y:h,name:"Upper",type:"scatter",line:{color:p.props.colors?"rgba("+i[7]+", 1)":"rgba("+r.getConversionRgba(p.props.colorForSub.color,1)+")",dash:"dash"},marker:{size:1},xaxis:"x"+e,yaxis:"y"+e}),q.push({x:g,y:y,name:"Lower",type:"scatter",line:{color:p.props.colors?"rgba("+i[7]+", 1)":"rgba("+r.getConversionRgba(p.props.colorForSub.color,1)+")",dash:"dash"},marker:{size:1},xaxis:"x"+e,yaxis:"y"+e})},b=2;b<4;b++)M(b);var D={xaxis:{zeroline:!1,showgrid:o.layout.props.xScale},yaxis:{domain:[.65,1],tickformat:r.getTickFormat(o,0),tickprefix:r.getPrefix(o,0),ticksuffix:r.getSuffix(o,0),showgrid:o.layout.props.yScale},xaxis2:{domain:[0,.45],anchor:"y2",showgrid:o.layout.props.xScale},yaxis2:{domain:[0,.45],anchor:"x2",showgrid:o.layout.props.yScale},xaxis3:{domain:[.55,1],anchor:"y3",showgrid:o.layout.props.xScale},yaxis3:{domain:[0,.45],anchor:"x3",showgrid:o.layout.props.yScale}};$(".advanced-analytics-toolsets-"+o.extId).html('<div id="aat-chart-'+o.extId+'" class="simple" style="width:100%;height:100%;"></div>');var N=e.draw(o,q,"aat-chart-"+o.extId,D);e.setEvents(N,o,s)}(),i.resolve()}),i.promise}}});
//# sourceMappingURL=../../maps/analysis/autocorrelation.js.map
