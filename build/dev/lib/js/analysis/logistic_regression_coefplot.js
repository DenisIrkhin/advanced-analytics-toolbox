"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,a,o){return{createCube:function(e,o){var r=o.layout,s=a.validateDimension(r.props.dimensions[0]),t=[{qNullSuppression:!0,qDef:{qFieldDefs:[s]}}],p=r.props.measures.length;o.rowsLabel=["(Intercept)",""!=r.props.measures[1].label?r.props.measures[1].label:a.validateMeasure(r.props.measures[0])];for(var i=a.validateMeasure(r.props.measures[0])+" as mea0, "+a.validateMeasure(r.props.measures[1])+" as mea1",l="mea0 ~ mea1",n="NN",u=2;u<p;u++){var d=a.validateMeasure(r.props.measures[u]);if(d.length>0){var c=","+d+" as mea"+u;i+=c,l+=" + mea"+u,n+="N",o.rowsLabel.push(a.validateMeasure(r.props.measures[u]))}}var g="list(coef(coe)[,1], coef(coe)[,2], coef(coe)[,2])";r.props.calcOddsRatio&&(g="list(exp(coef(coe)[,1]), exp(coef(coe)[,1] - 1.96*coef(coe)[,2]), exp(coef(coe)[,1] + 1.96*coef(coe)[,2]))");var m=a.splitData(r.props.splitDataset,r.props.splitPercentage,p);a.displayDebugModeMessage(r.props.debugMode);var y=a.getDebugSaveDatasetScript(r.props.debugMode,"debug_logistic_regression_coefplot.rda"),h="R.ScriptEvalExStr('"+n+"','"+y+" library(jsonlite); "+m+" lm_result <- glm("+l+', data=training_data, family=binomial(link="logit")); coe<-summary(lm_result);\n       res<-toJSON('+g+");res;',"+i+")";a.displayRScriptsToConsole(r.props.debugMode,[h]);var f=[{qDef:{qDef:h}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return o.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(t)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(f)}],!1),o.patchApplied=!0,null},drawChart:function(r){var s=o.defer(),t=r.layout,p=(a.validateDimension(t.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return r.backendApi.getData(p).then(function(o){r.layout.qHyperCube.qMeasureInfo;if(0===o[0].qMatrix[0][1].qText.length||"-"==o[0].qMatrix[0][1].qText)a.displayConnectionError(r.extId);else{a.displayReturnedDatasetToConsole(t.props.debugMode,o[0]);for(var p=a.getDefaultPaletteColor(),i=JSON.parse(o[0].qMatrix[0][1].qText),l=[],n=[],u=[],d=[],c=0;c<i[0].length;c++)l.push(i[0][c]),t.props.calcOddsRatio?(n.push(i[2][c]-i[0][c]),u.push(i[0][c]-i[1][c]),d.push(Math.abs(i[1][c])),d.push(Math.abs(i[2][c]))):(n.push(i[1][c]),u.push(i[2][c]),d.push(Math.abs(i[0][c]-i[1][c])),d.push(Math.abs(i[0][c]+i[2][c])));var g=Math.max.apply(null,d),m=[{x:l,y:r.rowsLabel,name:"Coefficients plot",error_x:{type:"data",symmetric:!1,array:n,arrayminus:u,thickness:t.props.borderWidth,color:t.props.colors?"rgba("+p[3]+",1)":"rgba("+a.getConversionRgba(t.props.colorForMain.color,1)+")"},type:"scatter",mode:"markers",marker:{color:t.props.colors?"rgba("+p[3]+",1)":"rgba("+a.getConversionRgba(t.props.colorForMain.color,1)+")",size:t.props.pointRadius}}],y={showlegend:r.layout.props.showLegend,xaxis:{showgrid:r.layout.props.xScale,side:r.layout.props.xAxisPosition,range:[1.1*g*-1,1.1*g]},yaxis:{showgrid:r.layout.props.yScale,side:r.layout.props.yAxisPosition,autorange:"reversed",range:[-1,r.rowsLabel.length]},separators:a.getSeparators(r,0),dragmode:"select",margin:{r:"right"==r.layout.props.yAxisPosition?r.layout.props.marginRight+70:r.layout.props.marginRight,l:"left"==r.layout.props.yAxisPosition?r.layout.props.marginLeft+70:r.layout.props.marginLeft,t:"top"==r.layout.props.xAxisPosition?r.layout.props.marginTop+70:r.layout.props.marginTop,b:"bottom"==r.layout.props.xAxisPosition?r.layout.props.marginBottom+70:r.layout.props.marginBottom}};$(".advanced-analytics-toolsets-"+r.extId).html('<div id="aat-chart-'+r.extId+'" style="width:100%;height:100%;"></div>'),e.draw(r,m,"aat-chart-"+r.extId,y)}return s.resolve()}),s.promise}}});
//# sourceMappingURL=../../maps/analysis/logistic_regression_coefplot.js.map
