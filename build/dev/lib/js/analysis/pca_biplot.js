"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var o=r.layout,t=a.validateDimension(o.props.dimensions[0]),s=[{qNullSuppression:!0,qDef:{qFieldDefs:[t]}}],i=o.props.measures.length;r.rowsLabel=[a.validateMeasure(o.props.measures[0])];for(var l=a.validateMeasure(o.props.measures[0])+" as mea0",p="q$mea0",n="N",u=1;u<i;u++){var g=a.validateMeasure(o.props.measures[u]);if(g.length>0){var c=","+g+" as mea"+u;l+=c,p+=",q$mea"+u,n+="N",r.rowsLabel.push(a.validateMeasure(o.props.measures[u]))}}a.displayDebugModeMessage(o.props.debugMode);var y=a.getDebugSaveDatasetScript(o.props.debugMode,"debug_pca_biplot.rda"),b="R.ScriptEvalExStr('"+n+"','"+y+" library(jsonlite); pca_result<-prcomp(data.frame("+p+"), scale = TRUE); json<-toJSON(list(summary(pca_result)$x, summary(pca_result)$rotation)); json;',"+l+")";a.displayRScriptsToConsole(o.props.debugMode,[b]);var d=[{qDef:{qDef:b}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(s)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(d)}],!1),r.patchApplied=!0,null},drawChart:function(o,t){var s=r.defer(),i=o.layout,l=a.validateDimension(i.props.dimensions[0]),p=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return o.backendApi.getData(p).then(function(r){o.layout.qHyperCube.qMeasureInfo;if(0===r[0].qMatrix[0][1].qText.length||"-"==r[0].qMatrix[0][1].qText)a.displayConnectionError(o.extId);else{a.displayReturnedDatasetToConsole(i.props.debugMode,r[0]);var p=a.getDefaultPaletteColor(),n=[],u=[];$.each(r[0].qMatrix,function(e,a){n.push(a[0].qElemNumber),u.push(a[0].qText)});var g=JSON.parse(r[0].qMatrix[0][1].qText),c=g[0],y=g[1],b=[],d=[],h=[],f=[];$.each(c,function(e,a){b.push(a[0]),d.push(a[1]),h.push(Math.abs(a[0])),f.push(Math.abs(a[1]))});var m=Math.max.apply(null,h),x=Math.max.apply(null,f),q=[{x:b,y:d,xaxis:"x2",yaxis:"y2",text:u,elemNum:n,name:l,mode:"markers",type:"scatter",marker:{color:i.props.colors?"rgba("+p[3]+",0.8)":"rgba("+a.getConversionRgba(i.props.colorForMain.color,.8)+")",size:i.props.bubbleSize}}],v=[],M=[],D=[],w=[];$.each(y,function(e,a){v.push(a[0]),M.push(a[1]),D.push(Math.abs(a[0])),w.push(Math.abs(a[1]))});for(var S=Math.max.apply(null,D),C=Math.max.apply(null,w),L={xaxis:{title:"PC1",titlefont:{color:"rgb(148, 103, 189)"},showgrid:o.layout.props.xScale,tickfont:{color:"rgb(148, 103, 189)"},overlaying:"x",side:"bottom",range:[S*-1*1.1,1.1*S]},yaxis:{title:"PC2",showgrid:o.layout.props.yScale,titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"y",side:"left",range:[C*-1*1.1,1.1*C]},xaxis2:{titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"x",side:"top",range:[m*-1*1.1,1.1*m]},yaxis2:{titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"y",side:"right",range:[x*-1*1.1,1.1*x]},margin:{r:"right"==o.layout.props.yAxisPosition?o.layout.props.marginRight+70:o.layout.props.marginRight,l:"left"==o.layout.props.yAxisPosition?o.layout.props.marginLeft+70:o.layout.props.marginLeft,t:"top"==o.layout.props.xAxisPosition?o.layout.props.marginTop+70:o.layout.props.marginTop,b:"bottom"==o.layout.props.xAxisPosition?o.layout.props.marginBottom+70:o.layout.props.marginBottom},annotations:[]},P=0;P<o.rowsLabel.length;P++)L.annotations.push({x:v[P],y:M[P],xref:"x",yref:"y",ax:0,ay:0,axref:"x",ayref:"y",showarrow:!0,arrowcolor:i.props.colors?"rgba("+p[7]+", 1)":"rgba("+a.getConversionRgba(i.props.colorForSub.color,1)+")",arrowhead:3},{x:v[P],y:M[P],text:o.rowsLabel[P],font:{color:i.props.colors?"rgba("+p[7]+", 1)":"rgba("+a.getConversionRgba(i.props.colorForSub.color,1)+")"},showarrow:!1});$(".advanced-analytics-toolsets-"+o.extId).html('<div id="aat-chart-'+o.extId+'" style="width:100%;height:100%;"></div>');var T=e.draw(o,t,q,"aat-chart-"+o.extId,L);e.setEvents(T,o,t)}return s.resolve()}),s.promise}}});
//# sourceMappingURL=../../maps/analysis/pca_biplot.js.map
