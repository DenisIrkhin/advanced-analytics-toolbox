"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,r,o){return{createCube:function(e,o){var a=o.layout,s=r.validateDimension(a.props.dimensions[0]),t=[{qNullSuppression:!0,qDef:{qFieldDefs:[s]}}],i=a.props.measures.length;o.rowsLabel=[r.validateMeasure(a.props.measures[0])];for(var p=r.validateMeasure(a.props.measures[0])+" as mea0",l="q$mea0",n="N",d=1;d<i;d++){var u=r.validateMeasure(a.props.measures[d]);if(u.length>0){var c=","+u+" as mea"+d;p+=c,l+=",q$mea"+d,n+="N",o.rowsLabel.push(r.validateMeasure(a.props.measures[d]))}}r.displayDebugModeMessage(a.props.debugMode);var g=r.getDebugSaveDatasetScript(a.props.debugMode,"debug_pca_variance.rda"),f="R.ScriptEvalExStr('"+n+"','"+g+" library(jsonlite); pca_result<-prcomp(data.frame("+l+"), center = TRUE, scale = TRUE); json<-toJSON(summary(pca_result)$importance); json;',"+p+")";r.displayRScriptsToConsole(a.props.debugMode,[f]);var q=[{qDef:{qDef:f}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return o.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(t)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(q)}],!1),o.patchApplied=!0,null},drawChart:function(a){var s=o.defer(),t=a.layout,i=(r.validateDimension(t.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return a.backendApi.getData(i).then(function(o){a.layout.qHyperCube.qMeasureInfo;if(0===o[0].qMatrix[0][1].qText.length||"-"==o[0].qMatrix[0][1].qText)r.displayConnectionError(a.extId);else{r.displayReturnedDatasetToConsole(t.props.debugMode,o[0]);for(var i=r.getDefaultPaletteColor(),p=JSON.parse(o[0].qMatrix[0][1].qText),l=p[1],n=p[2],d=[],u=0;u<l.length;u++)d.push("PC"+(u+1));var c=[{x:d,y:l,name:"Proportion of variance",mode:"lines+markers",type:"bar",fill:t.props.line,fillcolor:t.props.colors?"rgba("+i[3]+",0.3)":"rgba("+r.getConversionRgba(t.props.colorForMain.color,.3)+")",marker:{color:t.props.colors?"rgba("+i[3]+",1)":"rgba("+r.getConversionRgba(t.props.colorForMain.color,1)+")",size:t.props.datapoints?t.props.pointRadius:1},line:{width:t.props.borderWidth}},{x:d,y:n,name:"Cumulative proportion",mode:"lines+markers",fill:t.props.line,fillcolor:t.props.colors?"rgba("+i[7]+",0.3)":"rgba("+r.getConversionRgba(t.props.colorForSub.color,.3)+")",marker:{color:t.props.colors?"rgba("+i[7]+",1)":"rgba("+r.getConversionRgba(t.props.colorForSub.color,1)+")",size:t.props.datapoints?t.props.pointRadius:1},line:{width:t.props.borderWidth}}],g={showlegend:a.layout.props.showLegend,xaxis:{title:a.layout.props.xLabelsAndTitle?"Principal components":"",showgrid:a.layout.props.xScale,side:a.layout.props.xAxisPosition,type:a.layout.props.xAxisType},yaxis:{title:a.layout.props.yLabelsAndTitle?"Variance":"",showgrid:a.layout.props.yScale,side:a.layout.props.yAxisPosition,tickformat:r.getTickFormat(a,0),tickprefix:r.getPrefix(a,0),ticksuffix:r.getSuffix(a,0)}};$(".advanced-analytics-toolsets-"+a.extId).html('<div id="aat-chart-'+a.extId+'" style="width:100%;height:100%;"></div>'),e.draw(a,c,"aat-chart-"+a.extId,g)}return s.resolve()}),s.promise}}});
//# sourceMappingURL=../../maps/analysis/pca_variance.js.map
