"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,r,o){return{createCube:function(e,o){var s=o.layout,a=r.validateDimension(s.props.dimensions[0]),p=[{qNullSuppression:!0,qDef:{qFieldDefs:[a],qSortCriterias:[{qSortByExpression:s.props.dimSort||!s.props.dimSortByExpression?0:s.props.dimSortByExpressionAsc,qSortByNumeric:s.props.dimSort?1:s.props.dimSortByNum?s.props.dimSortByNumAsc:0,qSortByAscii:s.props.dimSort||!s.props.dimSortByAlph?0:s.props.dimSortByAlphAsc,qExpression:{qv:s.props.dimSortByExpressionString}}]}}],t=s.props.measures.length;o.rowsLabel=["(Intercept)",r.validateMeasure(s.props.measures[1])];for(var i=r.validateMeasure(s.props.measures[0])+" as mea0, "+r.validateMeasure(s.props.measures[1])+" as mea1",l="q$mea0 ~ q$mea1",n=2;n<t;n++){var u=r.validateMeasure(s.props.measures[n]);if(u.length>0){var d=","+u+" as mea"+n;i+=d,l+=" + q$mea"+n,o.rowsLabel.push(r.validateMeasure(s.props.measures[n]))}}r.displayDebugModeMessage(s.props.debugMode);var c=r.getDebugSaveDatasetScript(s.props.debugMode,"debug_regression_analysis_line_chart.rda"),m="R.ScriptEval('"+c+" lm_result <- lm("+l+');predict(lm_result, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+")[,1]',"+i+")",q="R.ScriptEval('lm_result <- lm("+l+');predict(lm_result, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+")[,2]',"+i+")",v="R.ScriptEval('lm_result <- lm("+l+');predict(lm_result, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+")[,3]',"+i+")";r.displayRScriptsToConsole(s.props.debugMode,[m,q,v]);var g=r.validateMeasure(s.props.measures[0]),f=[{qDef:{qDef:g}},{qDef:{qDef:m}},{qDef:{qDef:q}},{qDef:{qDef:v}},{qDef:{qLabel:"-",qDef:""}}];return o.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(p)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(f)}],!1),o.patchApplied=!0,null},drawChart:function(s,a){var p=o.defer(),t=s.layout,i=(r.validateDimension(t.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}]);return s.backendApi.getData(i).then(function(o){var i=s.layout.qHyperCube.qMeasureInfo;if(isNaN(i[1].qMin)&&isNaN(i[1].qMax)&&isNaN(i[2].qMin)&&isNaN(i[2].qMax)&&isNaN(i[3].qMin)&&isNaN(i[3].qMax))r.displayConnectionError(s.extId);else{r.displayReturnedDatasetToConsole(t.props.debugMode,o[0]);var l=r.getDefaultPaletteColor(),n=[],u=[],d=[],c=[],m=[],q=[];$.each(o[0].qMatrix,function(e,r){n.push(r[0].qElemNumber),u.push(r[0].qText),d.push(r[1].qNum),c.push(r[2].qNum),m.push(r[3].qNum),q.push(r[4].qNum)});var v=[{x:u,y:d,elemNum:n,name:"Observed",mode:"lines+markers",fill:t.props.line,fillcolor:t.props.colors?"rgba("+l[3]+",0.3)":"rgba("+r.getConversionRgba(t.props.colorForMain.color,.3)+")",marker:{color:t.props.colors?"rgba("+l[3]+",1)":"rgba("+r.getConversionRgba(t.props.colorForMain.color,1)+")",size:t.props.datapoints?t.props.pointRadius:1},line:{width:t.props.borderWidth}},{x:u,y:c,name:"Fit",line:{color:t.props.colors?"rgba("+l[7]+", 1)":"rgba("+r.getConversionRgba(t.props.colorForSub.color,1)+")"}},{x:u,y:m,name:"Lower",fill:"tonexty",fillcolor:t.props.colors?"rgba("+l[7]+",0.3)":"rgba("+r.getConversionRgba(t.props.colorForSub.color,.3)+")",type:"scatter",mode:"none"},{x:u,y:q,name:"Upper",fill:"tonexty",fillcolor:t.props.colors?"rgba("+l[7]+",0.3)":"rgba("+r.getConversionRgba(t.props.colorForSub.color,.3)+")",type:"scatter",mode:"none"}];$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" style="width:100%;height:100%;"></div>');var g=e.draw(s,v,"aat-chart-"+s.extId,null);e.setEvents(g,s,a)}return p.resolve()}),p.promise}}});
//# sourceMappingURL=../../maps/analysis/regression_analysis_line_chart.js.map
