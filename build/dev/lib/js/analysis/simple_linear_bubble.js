"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,r,a){return{createCube:function(e,a){var s=a.layout,o=r.validateDimension(s.props.dimensions[0]),l=[{qNullSuppression:!0,qDef:{qFieldDefs:[o]}}];r.displayDebugModeMessage(s.props.debugMode);var t=r.getDebugSaveDatasetScript(s.props.debugMode,"debug_simple_linear_bubble.rda"),p=r.validateMeasure(s.props.measures[0]),i=r.validateMeasure(s.props.measures[1]),n="R.ScriptEval('"+t+' lm_result <- lm(q$Measure2~q$Measure1);predict(lm_result, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+")[,1]',"+p+" as Measure1, "+i+" as Measure2)",u="R.ScriptEval('lm_result <- lm(q$Measure2~q$Measure1);predict(lm_result, interval=\""+s.props.interval+'", level='+s.props.confidenceLevel+")[,2]',"+p+" as Measure1, "+i+" as Measure2)",m="R.ScriptEval('lm_result <- lm(q$Measure2~q$Measure1);predict(lm_result, interval=\""+s.props.interval+'", level='+s.props.confidenceLevel+")[,3]',"+p+" as Measure1, "+i+" as Measure2)";r.displayRScriptsToConsole(s.props.debugMode,[n,u,m]);var c=[{qDef:{qDef:p}},{qDef:{qDef:i}},{qDef:{qLabel:"Fit",qDef:n}},{qDef:{qLabel:"Lower",qDef:u}},{qDef:{qLabel:"Upper",qDef:m}}];return a.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(l)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(c)}],!1),a.patchApplied=!0,null},drawChart:function(s,o){var l=a.defer(),t=s.layout,p=r.validateDimension(t.props.dimensions[0]);return r.pageExtensionData(s,function(a){var i=s.layout.qHyperCube.qMeasureInfo;if(isNaN(i[2].qMin)&&isNaN(i[2].qMax)&&isNaN(i[3].qMin)&&isNaN(i[3].qMax)&&isNaN(i[4].qMin)&&isNaN(i[4].qMax))r.displayConnectionError(s.extId);else{r.displayReturnedDatasetToConsole(t.props.debugMode,a);var n=r.getDefaultPaletteColor(),u=[],m=[],c=[],d=[],q=[],b=[],v=[],f=a.map(function(e){return{elemNum:e[0].qElemNumber,dim1:e[0].qText,mea1:e[1].qNum,mea2:e[2].qNum,mea3:e[3].qNum,mea4:e[4].qNum,mea5:e[5].qNum}});f.sort(function(e,r){return parseFloat(e.mea1)-parseFloat(r.mea1)}),$.each(f,function(e,r){u.push(r.elemNum),m.push(r.dim1),c.push(r.mea1),d.push(r.mea2),q.push(r.mea3),b.push(r.mea4),v.push(r.mea5)});var g=[{x:c,y:d,elemNum:u,text:m,name:p,mode:"markers",type:"scatter",marker:{color:t.props.colors?"rgba("+n[3]+",0.8)":"rgba("+r.getConversionRgba(t.props.colorForMain.color,.8)+")",size:t.props.bubbleSize}},{x:c,y:q,name:"Fit",line:{color:t.props.colors?"rgba("+n[7]+", 1)":"rgba("+r.getConversionRgba(t.props.colorForSub.color,1)+")"}},{x:c,y:b,name:"Lower",fill:"tonexty",fillcolor:t.props.colors?"rgba("+n[7]+",0.3)":"rgba("+r.getConversionRgba(t.props.colorForSub.color,.3)+")",type:"scatter",mode:"none"},{x:c,y:v,name:"Upper",fill:"tonexty",fillcolor:t.props.colors?"rgba("+n[7]+",0.3)":"rgba("+r.getConversionRgba(t.props.colorForSub.color,.3)+")",type:"scatter",mode:"none"}];$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" style="width:100%;height:100%;"></div>');var M=e.draw(s,o,g,"aat-chart-"+s.extId,null);e.setEvents(M,s,o)}return l.resolve()}),l.promise}}});
//# sourceMappingURL=../../maps/analysis/simple_linear_bubble.js.map
